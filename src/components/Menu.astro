---
import { getCollection } from "astro:content";

const posts = await getCollection("blog");
---

<style>
  .icon {
    transition:
      opacity 0.3s ease-in-out,
      transform 0.3s ease-in-out;
    position: absolute;
    top: 0;
    left: 0;
  }

  .hidden-icon {
    opacity: 0;
    transform: rotate(90deg);
  }

  .visible-icon {
    opacity: 1;
    transform: rotate(0deg);
  }
</style>

<div class="relative h-8">
  <button
    id="toggle-menu"
    title="Toggle Menu"
    aria-expanded="false"
    aria-controls="menu"
    class="relative h-8 w-8"
  >
    <svg
      id="hamburger-icon"
      class="icon visible-icon h-8 w-8"
      stroke="#fff"
      fill="#fff"
      stroke-width="0"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path d="M4 11h12v2H4zm0-5h16v2H4zm0 12h7.235v-2H4z"></path>
    </svg>

    <svg
      id="close-icon"
      class="icon hidden-icon h-8 w-8"
      stroke="#fff"
      fill="#fff"
      stroke-width="0"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="m16.192 6.344-4.243 4.242-4.242-4.242-1.414 1.414L10.535 12l-4.242 4.242 1.414 1.414 4.242-4.242 4.243 4.242 1.414-1.414L13.364 12l4.242-4.242z"
      ></path>
    </svg>
  </button>

  <div
    id="menu"
    class="absolute left-0 z-20 hidden w-80 rounded border bg-white p-3 pb-5 shadow-sm dark:border-neutral-700 dark:bg-neutral-800"
  >
    <div class="mb-2 flex items-center justify-between">
      <div class="ml-2 text-xl font-bold dark:text-white">Menu</div>
    </div>

    <nav>
      {
        posts
          .filter(post => post.data.productDemo)
          .map(post => (
            <a href={`/posts/${post.slug}`} title={post.data.productDemo} class="sales-menu-link">
              {post.data.productDemo}
            </a>
          ))
      }
      <a href="/livechat-overlay" title="Live Chat - Overlay" class="sales-menu-link">
        Live Chat - Overlay
      </a>
      <a href="/broadcast-notification" title="Broadcast Notification" class="sales-menu-link">
        Broadcast Notification
      </a>
    </nav>
  </div>
</div>

<script>
  const toggleMenu = document.getElementById("toggle-menu");
  const menu = document.getElementById("menu");
  const hamburgerIcon = document.getElementById("hamburger-icon");
  const closeIcon = document.getElementById("close-icon");

  if (toggleMenu && menu && hamburgerIcon && closeIcon) {
    toggleMenu.addEventListener("click", () => {
      const isMenuOpen = menu.classList.toggle("hidden");
      toggleMenu.setAttribute("aria-expanded", (!isMenuOpen).toString());
      hamburgerIcon.classList.toggle("hidden-icon", !isMenuOpen);
      hamburgerIcon.classList.toggle("visible-icon", isMenuOpen);
      closeIcon.classList.toggle("hidden-icon", isMenuOpen);
      closeIcon.classList.toggle("visible-icon", !isMenuOpen);
    });
  }
</script>
